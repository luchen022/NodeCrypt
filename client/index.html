<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NodeCrypt</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/body.css">
    <link rel="stylesheet" href="css/phone.css">
    <link rel="stylesheet" href="css/form-animation.css">
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <meta name="description" content="NodeCrypt - True end-to-end encrypted chat system, no database, all messages encrypted locally, server only relays encrypted data, supports Cloudflare Workers, Docker, self-hosting and local development.">
    <meta name="keywords" content="end-to-end encryption, security, chat, WebSocket, Cloudflare Workers, JavaScript, E2EE, anonymous communication, AES, ECDH, RSA, ChaCha20, security, open source, NodeCrypt, shuaiplus">
    <meta name="author" content="shuaiplus">
    <meta property="og:title" content="NodeCrypt - End-to-End Encrypted Chat System">
    <meta property="og:description" content="NodeCrypt is a zero-knowledge, end-to-end encrypted open source chat system where all encryption and decryption is done locally on the client side, and servers cannot access plaintext. Supports multi-platform deployment, secure, anonymous, no message history.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://github.com/shuaiplus/NodeCrypt">
    <meta property="og:image" content="https://crypt.works/client/assets/favicon.svg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="NodeCrypt - End-to-End Encrypted Chat System">
    <meta name="twitter:description" content="NodeCrypt is a zero-knowledge, end-to-end encrypted open source chat system where all encryption and decryption is done locally on the client side, and servers cannot access plaintext.">
    <meta name="twitter:image" content="https://crypt.works/client/assets/favicon.svg">
    <meta name="google-site-verification" content="2KGYZcUDyYzGVeYAQ9mMRUGcTiMyZqFF6D7232SyGgw" />
    <style>
        /* æ·»åŠ ä¸€ä¸ªé¢„åŠ è½½æ ·å¼ï¼Œé¿å…é—ªçƒ */
        .preload * {
            -webkit-transition: none !important;
            -moz-transition: none !important;
            -ms-transition: none !important;
            -o-transition: none !important;
            transition: none !important;
        }
        
        /* å¯†ç éªŒè¯å®¹å™¨æ ·å¼ */
        #password-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .password-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .password-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
        }
        
        .password-title {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .password-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .password-input-group {
            position: relative;
            margin-bottom: 20px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .password-input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
        }
        
        .password-toggle:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .password-submit {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .password-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .password-submit:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .password-error {
            color: #ff4757;
            font-size: 14px;
            margin: 10px 0;
            min-height: 20px;
            text-align: center;
        }
        
        .password-hint {
            margin-top: 15px;
            font-size: 12px;
            color: #999;
        }
        
        .remember-container {
            display: flex;
            align-items: center;
            margin: 15px 0 20px;
            color: #666;
            font-size: 14px;
        }
        
        .remember-checkbox {
            margin-right: 8px;
            cursor: pointer;
        }
        
        .remember-label {
            cursor: pointer;
        }
        
        .attempts-info {
            margin: 10px 0;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            font-size: 13px;
            color: #856404;
        }
        
        .attempts-warning {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .attempts-locked {
            background: #e2e3e5;
            border-color: #d6d8db;
            color: #383d41;
        }
        
        .countdown-timer {
            font-weight: bold;
            color: #dc3545;
        }
        
        .attempts-count {
            display: inline-block;
            min-width: 20px;
            padding: 2px 6px;
            background: #ff6b6b;
            color: white;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body class="preload">
    <!-- å¯†ç éªŒè¯å®¹å™¨ -->
    <div id="password-container">
        <div class="password-box">
            <div class="password-logo">ğŸ”’</div>
            <h2 class="password-title">å®‰å…¨è®¿é—®éªŒè¯</h2>
            <p class="password-subtitle">è¯·è¾“å…¥è®¿é—®å¯†ç ä»¥ç»§ç»­ä½¿ç”¨ NodeCrypt</p>
            
            <!-- å°è¯•æ¬¡æ•°ä¿¡æ¯ -->
            <div id="attempts-info" class="attempts-info" style="display: none;"></div>
            
            <form id="password-form">
                <div class="password-input-group">
                    <input type="password" 
                           id="password-input" 
                           class="password-input" 
                           placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç "
                           autocomplete="off"
                           required
                           autofocus>
                    <button type="button" class="password-toggle" id="password-toggle">
                        ğŸ‘ï¸
                    </button>
                </div>
                
                <!-- è®°ä½ç™»å½•é€‰é¡¹ -->
                <div class="remember-container">
                    <input type="checkbox" id="remember-login" class="remember-checkbox">
                    <label for="remember-login" class="remember-label">åœ¨æ­¤è®¾å¤‡ä¸Šè®°ä½ç™»å½•çŠ¶æ€</label>
                </div>
                
                <div class="password-error" id="password-error"></div>
                
                <button type="submit" class="password-submit" id="password-submit">
                    éªŒè¯å¹¶è¿›å…¥
                </button>
            </form>
            
            <div class="password-hint">
                * å¯†ç åŒºåˆ†å¤§å°å†™ï¼Œè¯·ç¡®ä¿æ­£ç¡®è¾“å…¥
            </div>
        </div>
    </div>
    
    <div class="login-container" id="login-container" style="display:none;">
        <!-- ç¿»è½¬å¡ç‰‡å®¹å™¨ -->
        <div class="flip-card" id="flip-card">
            <div class="flip-card-inner">
                <!-- å¡ç‰‡æ­£é¢ - ç™»å½•è¡¨å• -->
                <div class="flip-card-front">
                    <!-- å¸®åŠ©æŒ‰é’® -->
                    <button class="help-btn" id="help-btn" type="button" data-i18n-title="help.usage_guide">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="17" r="1" fill="currentColor"/>
                        </svg>
                    </button>
                    <h1 id="login-title"></h1>
                    <form id="login-form">
                        <!-- ç™»å½•è¡¨å•å†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </form>
                </div>
                
                <!-- å¡ç‰‡èƒŒé¢ - ä½¿ç”¨è¯´æ˜ -->
                <div class="flip-card-back">
                    <button class="help-btn back-btn" id="back-btn" type="button" data-i18n-title="help.back_to_login">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <h2 data-i18n="help.usage_guide"></h2>
                    <div class="help-content">
                        <!-- ä½¿ç”¨è¯´æ˜å†…å®¹ -->
                    </div>
                </div>
            </div>
        </div>
        <div class="powered-by">
            Powered by <a href="https://github.com/shuaiplus/NodeCrypt" target="_blank" rel="noopener">NodeCrypt</a>
            &copy; 2025 by <a href="https://github.com/shuaiplus" target="_blank" rel="noopener">@shuaiplus</a>
        </div>
    </div>
    
    <div class="container" id="chat-container" style="display:none;">
        <!-- èŠå¤©ç•Œé¢å†…å®¹ -->
    </div>
    
    <script>
        // ============================================================
        // é…ç½®éƒ¨åˆ† - è¯·ä¿®æ”¹æ­¤å¤„
        // ============================================================
        
        // 2. ä¸‹é¢æ˜¯ "NodeCrypt@2025" çš„ SHA256 å“ˆå¸Œå€¼
        const PASSWORD_HASH = "2e1ab71220b0abedc6f3086347c27fa17393406470f730f49c8b0b45cd6ce37d"; // è¿™æ˜¯ç¤ºä¾‹å“ˆå¸Œï¼Œè¯·æ›¿æ¢
        
        // 3. ç™»å½•çŠ¶æ€æœ‰æ•ˆæœŸï¼ˆå•ä½ï¼šå¤©ï¼‰
        const LOGIN_EXPIRY_DAYS = 7;
        
        // 4. å®‰å…¨è®¾ç½® - å¯†ç é”™è¯¯æ¬¡æ•°é™åˆ¶
        const MAX_ATTEMPTS = 5; // æœ€å¤§å°è¯•æ¬¡æ•°
        const LOCK_TIME_MINUTES = 5; // é”å®šæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
        const RETRY_DELAY_SECONDS = [0, 5, 10, 30, 60]; // æ¯æ¬¡é”™è¯¯åçš„å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰
        
        // ============================================================
        
        // ç¼“å­˜é”®å
        const LOGIN_KEY = 'nodecrypt_logged_in';
        const LOGIN_TIMESTAMP_KEY = 'nodecrypt_login_timestamp';
        const REMEMBER_KEY = 'nodecrypt_remember_login';
        const FAILED_ATTEMPTS_KEY = 'nodecrypt_failed_attempts';
        const LOCKED_UNTIL_KEY = 'nodecrypt_locked_until';
        
        // DOM å…ƒç´ 
        const passwordContainer = document.getElementById('password-container');
        const passwordForm = document.getElementById('password-form');
        const passwordInput = document.getElementById('password-input');
        const passwordToggle = document.getElementById('password-toggle');
        const passwordSubmit = document.getElementById('password-submit');
        const passwordError = document.getElementById('password-error');
        const loginContainer = document.getElementById('login-container');
        const rememberCheckbox = document.getElementById('remember-login');
        const attemptsInfo = document.getElementById('attempts-info');
        
        // å…¨å±€å˜é‡
        let failedAttempts = 0;
        let lockedUntil = 0;
        let countdownInterval = null;
        
        // SHA256 å“ˆå¸Œå‡½æ•°
        async function sha256(message) {
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        // åŠ è½½å®‰å…¨çŠ¶æ€
        function loadSecurityStatus() {
            try {
                // åŠ è½½å¤±è´¥å°è¯•æ¬¡æ•°
                failedAttempts = parseInt(localStorage.getItem(FAILED_ATTEMPTS_KEY) || '0');
                
                // åŠ è½½é”å®šæ—¶é—´
                lockedUntil = parseInt(localStorage.getItem(LOCKED_UNTIL_KEY) || '0');
                
                return {
                    failedAttempts,
                    lockedUntil,
                    isLocked: lockedUntil > Date.now()
                };
            } catch (error) {
                console.error('åŠ è½½å®‰å…¨çŠ¶æ€æ—¶å‡ºé”™:', error);
                return { failedAttempts: 0, lockedUntil: 0, isLocked: false };
            }
        }
        
        // ä¿å­˜å®‰å…¨çŠ¶æ€
        function saveSecurityStatus() {
            try {
                localStorage.setItem(FAILED_ATTEMPTS_KEY, failedAttempts.toString());
                localStorage.setItem(LOCKED_UNTIL_KEY, lockedUntil.toString());
            } catch (error) {
                console.error('ä¿å­˜å®‰å…¨çŠ¶æ€æ—¶å‡ºé”™:', error);
            }
        }
        
        // é‡ç½®å®‰å…¨çŠ¶æ€ï¼ˆç™»å½•æˆåŠŸæ—¶è°ƒç”¨ï¼‰
        function resetSecurityStatus() {
            failedAttempts = 0;
            lockedUntil = 0;
            saveSecurityStatus();
        }
        
        // å¢åŠ å¤±è´¥å°è¯•æ¬¡æ•°
        function incrementFailedAttempts() {
            failedAttempts++;
            
            // å¦‚æœè¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œé”å®šè´¦æˆ·
            if (failedAttempts >= MAX_ATTEMPTS) {
                lockedUntil = Date.now() + (LOCK_TIME_MINUTES * 60 * 1000);
            }
            
            saveSecurityStatus();
            updateAttemptsInfo();
        }
        
        // æ›´æ–°å°è¯•æ¬¡æ•°ä¿¡æ¯æ˜¾ç¤º
        function updateAttemptsInfo() {
            const isLocked = lockedUntil > Date.now();
            
            if (failedAttempts === 0) {
                attemptsInfo.style.display = 'none';
                return;
            }
            
            attemptsInfo.style.display = 'block';
            
            if (isLocked) {
                // è´¦æˆ·è¢«é”å®š
                const remainingTime = Math.ceil((lockedUntil - Date.now()) / 1000);
                attemptsInfo.className = 'attempts-info attempts-locked';
                attemptsInfo.innerHTML = `
                    <strong>âš ï¸ è´¦æˆ·å·²æš‚æ—¶é”å®š</strong><br>
                    å‰©ä½™ç­‰å¾…æ—¶é—´ï¼š<span class="countdown-timer">${formatTime(remainingTime)}</span><br>
                    <small>è¯·ç­‰å¾… ${LOCK_TIME_MINUTES} åˆ†é’Ÿåé‡è¯•</small>
                `;
            } else {
                // è´¦æˆ·æœªé”å®šï¼Œæ˜¾ç¤ºå‰©ä½™å°è¯•æ¬¡æ•°
                const remainingAttempts = MAX_ATTEMPTS - failedAttempts;
                const isWarning = remainingAttempts <= 2;
                
                attemptsInfo.className = `attempts-info ${isWarning ? 'attempts-warning' : ''}`;
                attemptsInfo.innerHTML = `
                    <strong>${isWarning ? 'âš ï¸ è­¦å‘Šï¼š' : ''}å¯†ç é”™è¯¯</strong><br>
                    å‰©ä½™å°è¯•æ¬¡æ•°ï¼š<span class="attempts-count">${remainingAttempts}</span> / ${MAX_ATTEMPTS}
                    ${failedAttempts > 1 ? `<br><small>ä¸Šæ¬¡é”™è¯¯åéœ€è¦ç­‰å¾… ${RETRY_DELAY_SECONDS[Math.min(failedAttempts-1, RETRY_DELAY_SECONDS.length-1)]} ç§’</small>` : ''}
                `;
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´ï¼ˆç§’ -> åˆ†:ç§’ï¼‰
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
        function checkIfLocked() {
            const now = Date.now();
            
            if (lockedUntil > now) {
                // è¿˜åœ¨é”å®šæ—¶é—´å†…
                const remainingTime = Math.ceil((lockedUntil - now) / 1000);
                startCountdown(remainingTime);
                return true;
            } else if (lockedUntil !== 0) {
                // é”å®šæ—¶é—´å·²è¿‡ï¼Œé‡ç½®é”å®šçŠ¶æ€
                lockedUntil = 0;
                saveSecurityStatus();
            }
            
            return false;
        }
        
        // å¯åŠ¨å€’è®¡æ—¶
        function startCountdown(seconds) {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            // ç¦ç”¨è¾“å…¥å’Œæäº¤æŒ‰é’®
            passwordInput.disabled = true;
            passwordToggle.disabled = true;
            passwordSubmit.disabled = true;
            
            let timeLeft = seconds;
            updateCountdownButton(timeLeft);
            
            countdownInterval = setInterval(() => {
                timeLeft--;
                
                if (timeLeft <= 0) {
                    // å€’è®¡æ—¶ç»“æŸ
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                    
                    // å¯ç”¨è¾“å…¥å’ŒæŒ‰é’®
                    passwordInput.disabled = false;
                    passwordToggle.disabled = false;
                    passwordSubmit.disabled = false;
                    passwordSubmit.textContent = 'éªŒè¯å¹¶è¿›å…¥';
                    
                    // é‡ç½®é”å®šçŠ¶æ€
                    lockedUntil = 0;
                    saveSecurityStatus();
                    
                    // æ›´æ–°ä¿¡æ¯æ˜¾ç¤º
                    updateAttemptsInfo();
                    
                    // èšç„¦è¾“å…¥æ¡†
                    passwordInput.focus();
                } else {
                    updateCountdownButton(timeLeft);
                }
            }, 1000);
        }
        
        // æ›´æ–°å€’è®¡æ—¶æŒ‰é’®
        function updateCountdownButton(seconds) {
            passwordSubmit.textContent = `è¯·ç­‰å¾… ${formatTime(seconds)}`;
        }
        
        // åº”ç”¨é‡è¯•å»¶è¿Ÿ
        function applyRetryDelay() {
            if (failedAttempts > 1) {
                const delayIndex = Math.min(failedAttempts - 2, RETRY_DELAY_SECONDS.length - 1);
                const delaySeconds = RETRY_DELAY_SECONDS[delayIndex];
                
                if (delaySeconds > 0) {
                    // æ˜¾ç¤ºå»¶è¿Ÿæç¤º
                    passwordError.textContent = `å¯†ç é”™è¯¯ï¼Œè¯·ç­‰å¾… ${delaySeconds} ç§’åé‡è¯•`;
                    passwordError.style.display = 'block';
                    
                    // ç¦ç”¨è¾“å…¥å’ŒæŒ‰é’®
                    passwordInput.disabled = true;
                    passwordSubmit.disabled = true;
                    
                    let timeLeft = delaySeconds;
                    passwordSubmit.textContent = `ç­‰å¾… ${timeLeft} ç§’`;
                    
                    const delayInterval = setInterval(() => {
                        timeLeft--;
                        
                        if (timeLeft <= 0) {
                            clearInterval(delayInterval);
                            
                            // å¯ç”¨è¾“å…¥å’ŒæŒ‰é’®
                            passwordInput.disabled = false;
                            passwordSubmit.disabled = false;
                            passwordSubmit.textContent = 'éªŒè¯å¹¶è¿›å…¥';
                            passwordError.style.display = 'none';
                            
                            // èšç„¦è¾“å…¥æ¡†
                            passwordInput.focus();
                        } else {
                            passwordSubmit.textContent = `ç­‰å¾… ${timeLeft} ç§’`;
                        }
                    }, 1000);
                    
                    return true; // å·²åº”ç”¨å»¶è¿Ÿ
                }
            }
            return false; // æœªåº”ç”¨å»¶è¿Ÿ
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            try {
                const loggedIn = localStorage.getItem(LOGIN_KEY);
                const loginTimestamp = localStorage.getItem(LOGIN_TIMESTAMP_KEY);
                const rememberLogin = localStorage.getItem(REMEMBER_KEY);
                
                if (rememberLogin !== 'true') {
                    return false;
                }
                
                if (loggedIn === 'true' && loginTimestamp) {
                    const now = Date.now();
                    const loginTime = parseInt(loginTimestamp);
                    const expiryTime = loginTime + (LOGIN_EXPIRY_DAYS * 24 * 60 * 60 * 1000);
                    
                    if (now < expiryTime) {
                        return true;
                    } else {
                        clearLoginStatus();
                        return false;
                    }
                }
                return false;
            } catch (error) {
                console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€æ—¶å‡ºé”™:', error);
                return false;
            }
        }
        
        // ä¿å­˜ç™»å½•çŠ¶æ€
        function saveLoginStatus(remember = false) {
            if (remember) {
                localStorage.setItem(LOGIN_KEY, 'true');
                localStorage.setItem(LOGIN_TIMESTAMP_KEY, Date.now().toString());
                localStorage.setItem(REMEMBER_KEY, 'true');
            }
        }
        
        // æ¸…é™¤ç™»å½•çŠ¶æ€
        function clearLoginStatus() {
            localStorage.removeItem(LOGIN_KEY);
            localStorage.removeItem(LOGIN_TIMESTAMP_KEY);
            localStorage.removeItem(REMEMBER_KEY);
        }
        
        // åˆå§‹åŒ–é¡µé¢
        async function initializePage() {
            try {
                // åŠ è½½å®‰å…¨çŠ¶æ€
                loadSecurityStatus();
                
                // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
                if (checkIfLocked()) {
                    // æ›´æ–°é”å®šä¿¡æ¯
                    updateAttemptsInfo();
                    return;
                }
                
                // æ›´æ–°å°è¯•æ¬¡æ•°ä¿¡æ¯
                updateAttemptsInfo();
                
                // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
                const isLoggedIn = await checkLoginStatus();
                
                if (isLoggedIn) {
                    // å·²ç™»å½•ï¼Œç›´æ¥æ˜¾ç¤ºä¸»é¡µé¢
                    passwordContainer.style.display = 'none';
                    loginContainer.style.display = 'block';
                    document.body.classList.remove('preload');
                    rememberCheckbox.checked = true;
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–é¡µé¢æ—¶å‡ºé”™:', error);
            }
        }
        
        // å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
        passwordToggle.addEventListener('click', function() {
            if (this.disabled) return;
            
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
        });
        
        // å¯†ç éªŒè¯
        passwordForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const inputPassword = passwordInput.value.trim();
            const rememberLogin = rememberCheckbox.checked;
            
            // æ£€æŸ¥æ˜¯å¦è¢«é”å®š
            if (checkIfLocked()) {
                updateAttemptsInfo();
                return;
            }
            
            if (!inputPassword) {
                passwordError.textContent = 'è¯·è¾“å…¥å¯†ç ';
                passwordError.style.display = 'block';
                passwordInput.style.animation = 'none';
                setTimeout(() => {
                    passwordInput.style.animation = 'shake 0.5s ease';
                }, 10);
                return;
            }
            
            try {
                // åº”ç”¨é‡è¯•å»¶è¿Ÿï¼ˆå¦‚æœæœªåº”ç”¨å»¶è¿Ÿæ‰ç»§ç»­éªŒè¯ï¼‰
                if (applyRetryDelay()) {
                    return;
                }
                
                // è®¡ç®—è¾“å…¥å¯†ç çš„å“ˆå¸Œ
                const inputHash = await sha256(inputPassword);
                
                // æ¯”è¾ƒå“ˆå¸Œå€¼
                if (inputHash === PASSWORD_HASH) {
                    // å¯†ç æ­£ç¡®
                    passwordError.style.display = 'none';
                    
                    // é‡ç½®å®‰å…¨çŠ¶æ€
                    resetSecurityStatus();
                    
                    // ä¿å­˜ç™»å½•çŠ¶æ€
                    if (rememberLogin) {
                        saveLoginStatus(true);
                    } else {
                        clearLoginStatus();
                    }
                    
                    // åŠ¨ç”»è¿‡æ¸¡åˆ°ä¸»é¡µé¢
                    passwordContainer.style.opacity = '0';
                    
                    setTimeout(() => {
                        passwordContainer.style.display = 'none';
                        loginContainer.style.display = 'block';
                        document.body.classList.remove('preload');
                    }, 500);
                } else {
                    // å¯†ç é”™è¯¯
                    incrementFailedAttempts();
                    
                    // åº”ç”¨é”™è¯¯åŠ¨ç”»
                    passwordInput.style.animation = 'none';
                    setTimeout(() => {
                        passwordInput.style.animation = 'shake 0.5s ease';
                    }, 10);
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    passwordInput.value = '';
                    
                    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°
                    if (failedAttempts >= MAX_ATTEMPTS) {
                        // é”å®šè´¦æˆ·
                        passwordError.textContent = `å¯†ç é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œè´¦æˆ·å·²é”å®š ${LOCK_TIME_MINUTES} åˆ†é’Ÿ`;
                        checkIfLocked();
                    } else {
                        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                        passwordError.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
                    }
                    
                    passwordError.style.display = 'block';
                    
                    // èšç„¦è¾“å…¥æ¡†
                    passwordInput.focus();
                }
            } catch (error) {
                console.error('éªŒè¯å¯†ç æ—¶å‡ºé”™:', error);
                passwordError.textContent = 'éªŒè¯è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
                passwordError.style.display = 'block';
            }
        });
        
        // æŒ‰å›è½¦é”®æäº¤
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !passwordSubmit.disabled) {
                passwordForm.dispatchEvent(new Event('submit'));
            }
        });
        
        // é€€å‡ºç™»å½•å‡½æ•°
        function logout() {
            clearLoginStatus();
            location.reload();
        }
        
        // æ·»åŠ é”™è¯¯åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initializePage);
        
        // è°ƒè¯•ä¿¡æ¯
        console.log('å¯†ç ä¿æŠ¤ç³»ç»Ÿå·²åŠ è½½');
        console.log('å®‰å…¨é…ç½®ï¼š');
        console.log('- æœ€å¤§å°è¯•æ¬¡æ•°:', MAX_ATTEMPTS);
        console.log('- é”å®šæ—¶é—´:', LOCK_TIME_MINUTES, 'åˆ†é’Ÿ');
        console.log('- é‡è¯•å»¶è¿Ÿ:', RETRY_DELAY_SECONDS.join(', '), 'ç§’');
        
    </script>
    
    <script type="module" src="./js/main.js"></script>
</body>
</html>
